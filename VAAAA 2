Option Explicit

Sub CopiarUltimaLinha_Mensal_Para_Anual()

    Dim wsSrc As Worksheet, wsDst As Worksheet
    Dim srcRow As Long
    Dim dstRow As Long

    Dim oldCalc As XlCalculation
    Dim oldEvents As Boolean
    Dim oldScreen As Boolean

    On Error GoTo EH

    ' Performance
    oldCalc = Application.Calculation
    oldEvents = Application.EnableEvents
    oldScreen = Application.ScreenUpdating

    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.Calculation = xlCalculationManual

    ' Abas
    Set wsSrc = ThisWorkbook.Worksheets("Deb, CRICRA FII Fiagro (Mensal)")
    Set wsDst = ThisWorkbook.Worksheets("Deb, CRICRA FII Fiagro (Anual)")

    ' ===== ORIGEM: última data válida (coluna B) =====
    srcRow = LinhaDaMaiorData(wsSrc, "B")
    If srcRow = 0 Then Err.Raise 5, , "Não encontrei data válida na origem."

    ' ===== DESTINO: depois da maior data (coluna B) =====
    dstRow = LinhaDepoisDaMaiorData(wsDst, "B")

    ' ===== B:P =====
    wsDst.Range("B" & dstRow & ":P" & dstRow).Value = _
        wsSrc.Range("B" & srcRow & ":P" & srcRow).Value

    ' ===== S:U -> R:T =====
    wsDst.Range("R" & dstRow & ":T" & dstRow).Value = _
        wsSrc.Range("S" & srcRow & ":U" & srcRow).Value

    ' ===== Fórmulas U:Z =====
    If dstRow > 1 Then
        wsDst.Range("U" & dstRow & ":Z" & dstRow).FormulaR1C1 = _
            wsDst.Range("U" & (dstRow - 1) & ":Z" & (dstRow - 1)).FormulaR1C1
    End If

    ' ===== AC:AD -> AB:AC =====
    wsDst.Range("AB" & dstRow & ":AC" & dstRow).Value = _
        wsSrc.Range("AC" & srcRow & ":AD" & srcRow).Value

    MsgBox "OK! Colado após a maior data no Anual.", vbInformation

CleanExit:
    Application.Calculation = oldCalc
    Application.EnableEvents = oldEvents
    Application.ScreenUpdating = oldScreen
    Exit Sub

EH:
    Application.Calculation = oldCalc
    Application.EnableEvents = oldEvents
    Application.ScreenUpdating = oldScreen
    MsgBox "Erro: " & Err.Number & " - " & Err.Description, vbCritical
End Sub
